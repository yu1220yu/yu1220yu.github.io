<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Calendar</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.css" />
  <script src="https://kit.fontawesome.com/0304c19c0c.js" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
</head>

<body>
  <article id="app" class="container mt-1">
    <section class="d-flex align-items-center p-3">
      <h2 class="fa-solid me-auto">{{months[month]}}<span class="fa-solid fs-4 ps-2">{{year}}</span></h2>

      <button @click="lastMonth" class="btn border-0"><i class="fa-solid fa-angle-left"></i></button>
      <button @click="today" type="button"
        class="btn bg-secondary-subtle badge border-0 rounded-pill shadow-sm">today</button>
      <button @click="nextMonth" class="btn border-0"><i class="fa-solid fa-angle-right"></i></button>
    </section>
    <table class="table text-center table-group-divider">
      <thead>
        <tr>
          <th v-for="week in weeks" class="p-2">{{week}}</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="week in totalWeeks">
          <td v-for="day in 7">
            <button id="day"
              class="btn badge btn-outline-light text-dark rounded-circle border-0 border-dark-subtle position-relative"
              style="width: 44px; aspect-ratio: 1/1"
              :class="{'bg-secondary-subtle text-danger':isToday(getDayOfMonth(week,day))}"
              @click="choose">{{getDayOfMonth(week,day)}}
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <section class="d-flex" v-if="addToDo">
      <button @click="" class="btn badge bg-primary-subtle text-light border-0 shadow p-2 px-3 ms-auto"
        data-bs-toggle="modal" data-bs-target="#addModal">add</button>
      <!-- Modal -->
      <div class="modal fade" id="addModal" data-bs-backdrop="static">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header border-0">
              <h1 class="modal-title fs-5">{{ key }}</h1>
              <button type="button" class="btn btn-close shadow-none" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <input type="text" class="col-12 rounded-pill px-3 border-light-subtle">
            </div>
            <div class="modal-footer border-0">
              <button @click="setItemS" class="btn badge bg-success-subtle border-0 p-2 px-3 ms-4">ok</button>
              <button @click="getItemS" class="btn badge bg-warning-subtle border-0 p-2 px-3 ms-4">edit</button>
              <button @click="removeItemS" class="btn badge bg-danger-subtle border-0 p-2 px-3 ms-4">del</button>
            </div>
          </div>
        </div>
      </div>
    </section>

  </article>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

  <script>
    const { createApp } = Vue
    createApp({
      data() {
        return {
          year: '',
          month: '',
          months: ['January', 'Febrary', 'March', 'April', 'May', 'June', 'July', 'Auguest', 'September', 'October', 'November', 'December'],
          weeks: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
          firstDayOfWeek: '',
          daysInMonth: '',
          isEmpty: true,
          addToDo: false,
          modalDate: '',
          key: '',
        }
      },
      mounted() {
        this.today()
      },
      computed: {
        // 當月幾周
        totalWeeks() {
          return Math.ceil((this.daysInMonth + this.firstDayOfWeek) / 7)
        }
      },
      methods: {
        monthInfo() {
          // 當月第一天星期幾
          this.firstDayOfWeek = new Date(this.year, this.month, 1).getDay()
          // 當月幾天
          this.daysInMonth = new Date(this.year, this.month + 1, 0).getDate()
        },
        today() {
          // 年份
          this.year = new Date().getFullYear()
          // 月份
          this.month = new Date().getMonth()
          this.monthInfo()
        },
        lastMonth() {
          this.month--
          if (this.month < 0) {
            this.year--
            this.month = 11
          }
          this.monthInfo()
          this.resetUI()
        },
        nextMonth() {
          this.month++
          if (this.month > 11) {
            this.year++
            this.month = 0
          }
          this.monthInfo()
          this.resetUI()
        },
        getDayOfMonth(week, day) {
          // 該周該天是幾號
          dayOfMonth = (week - 1) * 7 + day - this.firstDayOfWeek
          return dayOfMonth < 1 || dayOfMonth > this.daysInMonth ? '' : dayOfMonth
        },
        isToday(day) {
          today = new Date()
          return this.year === today.getFullYear() && this.month === today.getMonth() && day === today.getDate()
        },
        choose(e) {
          // toastr
          toastr.options = {
            positionClass: 'toast-top-center',
            preventDuplicates: true,
            closeButton: true,
            progressBar: true,
          }
          toastr.info(e.target.innerText, this.months[this.month])

          this.resetUI()
          e.target.classList.add('bg-body-tertiary', 'shadow-sm')
          this.isEmpty = false
          this.addToDo = true
          this.modalDate = e.target.innerText
          this.key = `${this.modalDate}${this.months[this.month]}${this.year}`
        },
        resetUI() {
          document.querySelectorAll('#day').forEach(x => {
            x.classList.remove('bg-body-tertiary', 'shadow-sm')
          })
        },
        setItemS() {
          bootstrap.Modal.getOrCreateInstance(document.getElementById('addModal')).hide()
        },
        getItemS() {
          bootstrap.Modal.getOrCreateInstance(document.getElementById('addModal')).hide()
        },
        removeItemS() {
          bootstrap.Modal.getOrCreateInstance(document.getElementById('addModal')).hide()
        }
      }
    }).mount('#app')
  </script>
</body>

</html>